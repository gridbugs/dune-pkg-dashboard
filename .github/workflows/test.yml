name: test
on:
  - push
jobs:
  list-deps:
    runs-on: ubuntu-latest
    outputs:
      packages: ${{ steps.set-packages.outputs.matrix }}
    steps:
      - name: Checkout tree
        uses: actions/checkout@v4
      - id: set-packages
        run: |
          echo "matrix<<END" >> ${GITHUB_OUTPUT}
          ./ls-json.sh bonsai-deps >> ${GITHUB_OUTPUT}
          echo "END" >> ${GITHUB_OUTPUT}

     #run: echo "packages={\"foo\":[\"re\",\"seq\"]}" >> $GITHUB_OUTPUT

  build:
    needs: list-deps
    strategy:
      matrix:
        package: ${{ fromJSON(needs.list-deps.outputs.packages) }}


        #runs-on: ${{ matrix.os }}
    runs-on: ubuntu-latest

    steps:
      - name: Checkout tree
        uses: actions/checkout@v4
      - run: echo hello ${{ matrix.package }}
      #      - name: Set-up OCaml ${{ matrix.ocaml-compiler }}
      #        uses: ocaml/setup-ocaml@v2
      #        with:
      #          ocaml-compiler: ${{ matrix.ocaml-compiler }}
      #      - run: opam --help
