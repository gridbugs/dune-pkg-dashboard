name: test
on:
  - push
jobs:
  list-deps:
    runs-on: ubuntu-latest
    outputs:
      packages: ${{ steps.set-packages.outputs.packages }}
    steps:
      - id: set-packages
        run: echo "packages={foo:[\"re\",\"seq\"]}" >> $GITHUB_OUTPUT

  build:
    needs: list-deps
    strategy:
      matrix:
        os:
          - macos-latest
          - ubuntu-latest
        ocaml-compiler:
          - "5.1"
        package: ${{ fromJSON(needs.list-deps.outputs.packages.foo) }}

    runs-on: ${{ matrix.os }}

    steps:
      - name: Checkout tree
        uses: actions/checkout@v4
      - run: echo hello ${{ matrix.package }}
      #      - name: Set-up OCaml ${{ matrix.ocaml-compiler }}
      #        uses: ocaml/setup-ocaml@v2
      #        with:
      #          ocaml-compiler: ${{ matrix.ocaml-compiler }}
      #      - run: opam --help
